(self.webpackChunkapp=self.webpackChunkapp||[]).push([[634],{2634:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AviatorModule:()=>O});var o={};n.r(o),n.d(o,{switchAntialias:()=>d,switchFlyMode:()=>h,vrSessionEnd:()=>w,vrSessionStart:()=>l});var s=n(8583),a=n(8873),i=n(9812),r=n(7747),c=n(5466);const h=(0,c.PH)("[Aviator] switch fly mode"),d=(0,c.PH)("[Aviator] switch antialias"),l=(0,c.PH)("[Aviator] VR session start"),w=(0,c.PH)("[Aviator] VR session end");(0,c.G0)(o);var p=n(7716),m=n(457),u=n(9505),v=n(270),S=n(2628),f=n(5319),y=n(7758);class M extends y.u9r{constructor(t){super();const e=[],n=[],o=new y.iMs;o.ray.direction.set(0,-1,0);for(let s=0;s<2e3;s++){const s=500*Math.random()-250,a=500*Math.random()-250;o.ray.origin.set(s,50,a);const i=o.intersectObject(t);if(0===i.length)continue;const r=i[0].point.y,c=5*Math.random()+.5;let h=Math.random()*Math.PI*2;e.push(s+Math.sin(h),r,a+Math.cos(h)),e.push(s,r+c,a),e.push(s+Math.sin(h+Math.PI),r,a+Math.cos(h+Math.PI)),h+=Math.PI/2,e.push(s+Math.sin(h),r,a+Math.cos(h)),e.push(s,r+c,a),e.push(s+Math.sin(h+Math.PI),r,a+Math.cos(h+Math.PI));const d=.1*Math.random();for(let t=0;t<6;t++)n.push(.2+d,.4+d,0)}this.setAttribute("position",new y.TlE(new Float32Array(e),3)),this.setAttribute("color",new y.TlE(new Float32Array(n),3))}}var g=n(8804);class b extends y.Hyl{constructor(t){super(),this.size=t,this.point=new y.Pa4,this.tangent=new y.Pa4}getPointAt(t){t=t*Math.PI*2;const e=Math.sin(3*t)*Math.cos(4*t)*this.size,n=2*Math.sin(10*t)+2*Math.cos(17*t)+5,o=Math.sin(t)*Math.sin(4*t)*this.size;return this.point.set(e,n,o).multiplyScalar(2)}getTangentAt(t){const e=1e-4,n=Math.max(0,t-e),o=Math.min(1,t+e);return this.tangent.copy(this.getPointAt(o)).sub(this.getPointAt(n)).normalize()}}const A=(t,e,n,o,s)=>{const a=((t,e)=>{const n=[],o=t.getX(e),s=t.getY(e),a=t.getZ(e);for(let i=0;i<t.array.length;i++)o===t.getX(i)&&s===t.getY(i)&&a===t.getZ(i)&&n.push(i);return n})(t,e);((t,e,n,o,s)=>{("number"==typeof e?[e]:e).map(e=>{t.setXYZ(e,t.getX(e)+n,t.getY(e)+o,t.getZ(e)+s)})})(t,a,n,o,s)};var x=(()=>(function(t){t[t.red=15881030]="red",t[t.white=14209233]="white",t[t.brown=5845806]="brown",t[t.pink=16095342]="pink",t[t.brownDark=2300175]="brownDark",t[t.blue=6865856]="blue"}(x||(x={})),x))();class P{constructor(){this.mesh=new y.Tme,this.mesh.name="pilot",this.angleHairs=0;const t=new y.DvJ(15,15,15),e=new y.xoR({color:x.brown,flatShading:!0}),n=new y.Kj0(t,e);n.position.set(2,-12,0),this.mesh.add(n);const o=new y.DvJ(10,10,10),s=new y.YBo({color:x.pink}),a=new y.Kj0(o,s);this.mesh.add(a);const i=new y.DvJ(4,4,4),r=new y.YBo({color:x.brown}),c=new y.Kj0(i,r);c.geometry.applyMatrix4((new y.yGw).makeTranslation(0,2,0));const h=new y.Tme;this.hairsTop=new y.Tme;for(let y=0;y<12;y++){const t=c.clone(),e=y%3,n=Math.floor(y/3);t.position.set(4*n-4,0,4*e-4),this.hairsTop.add(t)}h.add(this.hairsTop);const d=new y.DvJ(12,4,2);d.applyMatrix4((new y.yGw).makeTranslation(-6,0,0));const l=new y.Kj0(d,r),w=l.clone();l.position.set(8,-2,6),w.position.set(8,-2,-6),h.add(l),h.add(w);const p=new y.DvJ(2,8,10),m=new y.Kj0(p,r);m.position.set(-1,-4,0),h.add(m),h.position.set(-5,5,0),this.mesh.add(h);const u=new y.DvJ(5,5,5),v=new y.YBo({color:x.brown}),S=new y.Kj0(u,v);S.position.set(6,0,3);const f=S.clone();f.position.z=-S.position.z;const M=new y.DvJ(11,1,11),g=new y.Kj0(M,v);this.mesh.add(S),this.mesh.add(f),this.mesh.add(g);const b=new y.DvJ(2,3,2),A=new y.Kj0(b,s);A.position.set(0,0,-6);const P=A.clone();P.position.set(0,0,6),this.mesh.add(A),this.mesh.add(P)}update(t){const e=this.hairsTop.children,n=e.length;for(let o=0;o<n;o++)e[o].scale.y=.75+.25*Math.cos(this.angleHairs+o/3);this.angleHairs+=.16}}class j{constructor(){const t=new y.Tme;this.mesh=new y.Tme,this.mesh.name="airPlane";const e=new y.DvJ(80,50,50,1,1,1),n=e.getAttribute("position");A(n,4,0,-10,20),A(n,5,0,-10,-20),A(n,6,0,30,20),A(n,7,0,30,-20);const o=new y.xoR({color:x.red,flatShading:!0}),s=new y.Kj0(e,o);s.castShadow=!0,s.receiveShadow=!0,t.add(s);const a=new y.DvJ(20,50,50,1,1,1),i=new y.xoR({color:x.white,flatShading:!0}),r=new y.Kj0(a,i);r.position.x=50,r.castShadow=!0,r.receiveShadow=!0,t.add(r);const c=new y.DvJ(15,20,5,1,1,1),h=new y.xoR({color:x.red,flatShading:!0}),d=new y.Kj0(c,h);d.position.set(-40,20,0),d.castShadow=!0,d.receiveShadow=!0,t.add(d);const l=new y.DvJ(30,5,120,1,1,1),w=new y.xoR({color:x.red,flatShading:!0}),p=new y.Kj0(l,w);p.position.set(0,15,0),p.castShadow=!0,p.receiveShadow=!0,t.add(p);const m=new y.DvJ(3,15,20,1,1,1),u=new y.xoR({color:x.white,transparent:!0,opacity:.3,flatShading:!0}),v=new y.Kj0(m,u);v.position.set(5,27,0),v.castShadow=!0,v.receiveShadow=!0,t.add(v);const S=new y.DvJ(20,10,10,1,1,1),f=S.getAttribute("position");A(f,4,0,-5,5),A(f,5,0,-5,-5),A(f,6,0,5,5),A(f,7,0,5,-5);const M=new y.xoR({color:x.brown,flatShading:!0});this.propeller=new y.Kj0(S,M),this.propeller.castShadow=!0,this.propeller.receiveShadow=!0;const g=new y.DvJ(1,80,10,1,1,1),b=new y.xoR({color:x.brownDark,flatShading:!0}),j=new y.Kj0(g,b);j.position.set(8,0,0),j.castShadow=!0,j.receiveShadow=!0;const z=j.clone();z.rotation.x=Math.PI/2,z.castShadow=!0,z.receiveShadow=!0,this.propeller.add(j),this.propeller.add(z),this.propeller.position.set(60,0,0),t.add(this.propeller);const D=new y.DvJ(30,15,10,1,1,1),J=new y.xoR({color:x.red,flatShading:!0}),K=new y.Kj0(D,J);K.position.set(25,-20,25),t.add(K);const T=new y.DvJ(24,24,4),k=new y.xoR({color:x.brownDark,flatShading:!0}),R=new y.Kj0(T,k);R.position.set(25,-28,25);const $=new y.DvJ(10,10,6),I=new y.xoR({color:x.brown,flatShading:!0}),E=new y.Kj0($,I);R.add(E),t.add(R);const Y=K.clone();Y.position.z=-K.position.z,t.add(Y);const Z=R.clone();Z.position.z=-R.position.z,t.add(Z);const B=R.clone();B.scale.set(.5,.5,.5),B.position.set(-35,-5,0),t.add(B);const F=new y.DvJ(4,20,4);F.applyMatrix4((new y.yGw).makeTranslation(0,10,0));const O=new y.xoR({color:x.red,flatShading:!0}),C=new y.Kj0(F,O);C.position.set(-35,-5,0),C.rotation.z=-.3,t.add(C),this.pilot=new P,this.pilot.mesh.position.set(-10,27,0),t.add(this.pilot.mesh),t.castShadow=!0,t.receiveShadow=!0,t.rotateY(Math.PI/2),this.mesh.add(t)}update(t){this.propeller.rotation.x+=.3,this.pilot.update(t)}}const z={fov:50,near:.1,far:3e4,vrSession:{onStart:{camera:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},dolly:{position:{x:0,y:.7,z:2},rotation:{x:0,y:0,z:0}}},onEnd:{camera:{position:{x:0,y:.7,z:3},rotation:{x:0,y:0,z:0}},dolly:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}}}},D="aviator",J=(0,c.Lq)({flyMode:!1,vrSession:!1},(0,c.on)(h,t=>Object.assign(Object.assign({},t),{flyMode:!t.flyMode})),(0,c.on)(l,t=>Object.assign(Object.assign({},t),{vrSession:!0})),(0,c.on)(w,t=>Object.assign(Object.assign({},t),{vrSession:!1}))),K=(0,c.ZF)(D),T=(0,c.P1)(K,t=>t.flyMode),k=(0,c.P1)(K,t=>t.vrSession);let R=(()=>{class t{constructor(t){this.store=t,this.flyMode$=this.store.select(T),this.vrSession$=this.store.select(k)}dispatch(t){this.store.dispatch(t)}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(c.yh))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),$=(()=>{class t{constructor(t){this.facade=t,this.dollyCameraParams=z,this.subscription=new f.w,this.controlsActive=!1,this.animate=()=>{},this.completed=!1}buildScene(t){this.completed?this.update(t):(this.create(t),this.completed=!0)}create(t){const e=new S.$,n=new v.M;n.add(t);const o=new y.xsS;o.fog=new y.ybr(16243114,.1,500),o.background=new y.Ilk(16243114),this.dollyCameraParams.aspect=t.ratio();const s=new m.a(this.dollyCameraParams);e.add(s),t.resizeAdd(s);const a=new y.Tme;a.add(s),o.add(a),(()=>{const t=new y.vmT(11184810,0,.9),e=new y.Mig(14452852,.5),n=new y.Ox3(16777215,.9);n.position.set(150,350,350),n.castShadow=!0,n.shadow.camera.left=-400,n.shadow.camera.right=400,n.shadow.camera.top=400,n.shadow.camera.bottom=-400,n.shadow.camera.near=1,n.shadow.camera.far=1e3,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,o.add(t),o.add(e),o.add(n)})();const i=new b(50),r=new y.Pa4,c=new y.Pa4,h=new y.Pa4,d=new y.Pa4;let l=0,w=0,p=0,f=0,A=0,x=0;(()=>{const t=new y._12(500,500,15,15);t.rotateX(-Math.PI/2);const e=t.getAttribute("position").array,n=new y.Pa4;for(let h=0;h<e.length;h+=3){n.fromArray(e,h),n.x+=10*Math.random()-5,n.z+=10*Math.random()-5;const t=n.distanceTo(o.position)/5-25;n.y=Math.random()*Math.max(0,t),n.toArray(e,h)}t.computeVertexNormals();const s=new y.YBo({color:4222976}),a=new y.Kj0(t,s);o.add(a);const i=new M(a),r=new g.v({side:y.ehD,vertexColors:!0}),c=new y.Kj0(i,r);o.add(c)})();const P=new j,z=.01;P.mesh.scale.set(z,z,z),a.add(P.mesh),n.add(P),n.add({update:t=>{((t,e)=>{var n,o;w+=l,w%=1,c.copy(i.getPointAt(w-1e-4)),p=c.y-r.y,n=r,o=c,f=Math.atan2(o.z-n.z,o.x-n.x),x=A-f,r.copy(i.getPointAt(w)),a.position.copy(r),t.mesh.rotation.set(10*-p,30*x,110*x),t.mesh.position.y=30*-p+.2,s.rotation.set(0,0,20*x),h.copy(i.getTangentAt(w)),l-=1e-7*h.y*e,l=Math.max(8e-5,Math.min(2e-4,l)),a.lookAt(d.copy(r).sub(h)),A=f})(P,t)}}),this.controlsActive&&(this.controls=new u.bq(s.camera,t.renderer.domElement,{autoRotateSpeed:.2,autoRotate:!0,target:P.mesh.position}),n.add(this.controls)),this.subscription=this.facade.vrSession$.subscribe(t=>{t?e.onSessionStart():e.onSessionEnd()}),this.animate=()=>{t.renderer.setAnimationLoop(()=>{n.update(),t.renderer.render(o,s.camera)})},this.animate()}update(t){this.animate(),this.controlsActive&&this.controls.updateDomElement(t.renderer.domElement)}unsubscribe(){this.completed=!1,this.subscription.unsubscribe(),this.subscription=new f.w}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(R))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var I=n(2647),E=n(2107),Y=n(6534);const Z=[{path:"",component:(()=>{class t{constructor(t,e,n,o){this.window=t,this.service=e,this.app=n,this.facade=o,this.flyMode$=this.facade.flyMode$,this.stats$=this.app.stats$,this.antialias$=this.app.antialias$}onContainerInit(t){this.service.buildScene(t)}onSwitchFlyMode(){this.facade.dispatch(h())}onSwitchStats(){this.app.dispatch(r.q.switchStats())}onSwitchAntialias(){this.app.dispatch(r.q.switchAntialias())}onVRSessionStart(){this.facade.dispatch(l())}onVRSessionEnd(){this.facade.dispatch(w())}ngOnDestroy(){this.service.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(Window),p.Y36($),p.Y36(I.l),p.Y36(R))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-aviator-page"]],decls:5,vars:13,consts:[[3,"stats$","antialias$","vrButtonEnable","containerInit","vrSessionStart","vrSessionEnd"],[3,"flyModeActive","statsActive","hdDefinitionEnable","antialiasActive","switchFlyMode","switchStats","switchAntialias"]],template:function(t,e){1&t&&(p.TgZ(0,"app-container",0),p.NdJ("containerInit",function(t){return e.onContainerInit(t)})("vrSessionStart",function(){return e.onVRSessionStart()})("vrSessionEnd",function(){return e.onVRSessionEnd()}),p.qZA(),p.TgZ(1,"app-menu",1),p.NdJ("switchFlyMode",function(){return e.onSwitchFlyMode()})("switchStats",function(){return e.onSwitchStats()})("switchAntialias",function(){return e.onSwitchAntialias()}),p.ALo(2,"async"),p.ALo(3,"async"),p.ALo(4,"async"),p.qZA()),2&t&&(p.Q6J("stats$",e.stats$)("antialias$",e.antialias$)("vrButtonEnable",!0),p.xp6(1),p.Q6J("flyModeActive",p.lcZ(2,7,e.flyMode$))("statsActive",p.lcZ(3,9,e.stats$))("hdDefinitionEnable",!1)("antialiasActive",p.lcZ(4,11,e.antialias$)))},directives:[E.e,Y.M],pipes:[s.Ov],styles:["canvas{background:linear-gradient(#e4e0ba,#f7d9aa)}"]}),t})()}];let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[i.Bz.forChild(Z)],i.Bz]}),t})(),F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[c.Aw.forFeature(D,J)]]}),t})(),O=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[s.ez,a.m,B,F]]}),t})()}}]);