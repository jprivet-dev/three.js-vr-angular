(self.webpackChunkapp=self.webpackChunkapp||[]).push([[349],{8349:(t,s,i)=>{"use strict";i.r(s),i.d(s,{EarthModule:()=>I});var e={};i.r(e),i.d(e,{flyModeOff:()=>h,switchFlyMode:()=>d,vrSessionEnd:()=>p,vrSessionStart:()=>l});var n=i(8583),o=i(8873),a=i(9812),r=i(7747),c=i(5466);const d=(0,c.PH)("[Earth] switch fly mode"),h=(0,c.PH)("[Earth] set fly mode off"),l=(0,c.PH)("[Earth] VR session start"),p=(0,c.PH)("[Earth] VR session end");(0,c.G0)(e);var f=i(7716),u=i(4930),w=i(8120),S=i(3607),y=i(949),m=i(270),v=i(3841),b=i(9088),A=i(8656),$=i(8509),M=i(2628),g=i(5319);const E={fov:80,near:1,far:8e3,vrSession:{onStart:{camera:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},dolly:{position:{x:.5,y:0,z:2.5},rotation:{x:0,y:0,z:0}}},onEnd:{camera:{position:{x:0,y:0,z:5},rotation:{x:0,y:0,z:0}},dolly:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}}}};var D=i(2647);const z="earth",C=(0,c.Lq)({flyMode:!1,vrSession:!1},(0,c.on)(d,t=>Object.assign(Object.assign({},t),{flyMode:!t.flyMode})),(0,c.on)(h,t=>Object.assign(Object.assign({},t),{flyMode:!1})),(0,c.on)(l,t=>Object.assign(Object.assign({},t),{vrSession:!0})),(0,c.on)(p,t=>Object.assign(Object.assign({},t),{vrSession:!1}))),k=(0,c.ZF)(z),j=(0,c.P1)(k,t=>t.flyMode),L=(0,c.P1)(k,t=>t.vrSession);let O=(()=>{class t{constructor(t){this.store=t,this.flyMode$=this.store.select(j),this.vrSession$=this.store.select(L)}dispatch(t){this.store.dispatch(t)}}return t.\u0275fac=function(s){return new(s||t)(f.LFG(c.yh))},t.\u0275prov=f.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),x=(()=>{class t{constructor(t,s){this.app=t,this.facade=s,this.subscription=new g.w,this.dollyCameraParams=E,this.controlsUpdate=()=>{},this.vrControllersUpdate=()=>{},this.animate=()=>{},this.completed=!1}buildScene(t){this.completed?this.update(t):(this.create(t),this.completed=!0)}create(t){const s=new M.$,i=new y.I,e=new m.M;e.add(t);const n=new A.d;i.add(n);const o=n.scene;this.dollyCameraParams.aspect=t.ratio();const a=new u.ak(this.dollyCameraParams);t.resizeAdd(a),o.add(a),s.add(a);const r=new S.Ck;o.add(r.light),i.add(r);const c=new v.I;o.add(c.mesh),i.add(c),e.add(c);const d=new b.J;d.mesh.position.set(2,0,0),o.add(d.mesh),i.add(d),e.add(d),this.subscription.add(this.app.definition$.subscribe(t=>{i.loadTexturesByDefinition(t)}));const l=new w.JZ(a.camera,t.renderer.domElement,{autoRotateSpeed:.2,autoRotate:!0,target:c.mesh.position.clone()});e.add(l),this.controlsUpdate=t=>{l.updateDomElement(t.renderer.domElement)};const p=new u.j_(a,t);if(e.add(p),p.pointerLock.onLock(()=>{l.disable()}),p.pointerLock.onUnlock(()=>{l.enable(),this.facade.dispatch(h())}),this.subscription.add(this.facade.flyMode$.subscribe(t=>{t?p.start():p.stop()})),this.subscription.add(this.facade.vrSession$.subscribe(t=>{t?s.onSessionStart():s.onSessionEnd()})),t.vrSession){const s=new $.Q2(t,5);o.add(s.controller),o.add(s.grip);const i=new $.ah(t,5);o.add(i.controller),o.add(i.grip);const n=new u.ky(a,t);e.add(n),s.onSelectStart(()=>{n.moveSwitch()}),i.onSelectStart(()=>{n.moveSwitch()}),this.vrControllersUpdate=t=>{o.remove(s.controller,s.grip,i.controller,i.grip),s.updateContainer(t),o.add(s.controller),o.add(s.grip),i.updateContainer(t),o.add(i.controller),o.add(i.grip)}}this.animate=t=>{t.renderer.setAnimationLoop(()=>{e.update(),t.renderer.render(o,a.camera)})},this.animate(t)}update(t){this.controlsUpdate(t),this.vrControllersUpdate(t),this.animate(t)}unsubscribe(){this.completed=!1,this.subscription.unsubscribe(),this.subscription=new g.w}}return t.\u0275fac=function(s){return new(s||t)(f.LFG(D.l),f.LFG(O))},t.\u0275prov=f.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=i(2107),Z=i(6534);const J=[{path:"",component:(()=>{class t{constructor(t,s,i,e){this.window=t,this.service=s,this.app=i,this.facade=e,this.flyMode$=this.facade.flyMode$,this.stats$=this.app.stats$,this.isHDDefinition$=this.app.isHDDefinition$,this.antialias$=this.app.antialias$}onContainerInit(t){this.service.buildScene(t)}onSwitchFlyMode(){this.facade.dispatch(d())}onSwitchStats(){this.app.dispatch(r.q.switchStats())}onSwitchDefinition(){this.app.dispatch(r.q.switchDefinition())}onSwitchAntialias(){this.app.dispatch(r.q.switchAntialias())}onVRSessionStart(){this.facade.dispatch(l())}onVRSessionEnd(){this.facade.dispatch(p())}ngOnDestroy(){this.service.unsubscribe()}}return t.\u0275fac=function(s){return new(s||t)(f.Y36(Window),f.Y36(x),f.Y36(D.l),f.Y36(O))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-earth-page"]],decls:6,vars:15,consts:[[3,"stats$","antialias$","vrButtonEnable","containerInit","vrSessionStart","vrSessionEnd"],[3,"flyModeActive","statsActive","hdDefinitionActive","antialiasActive","switchFlyMode","switchStats","switchDefinition","switchAntialias"]],template:function(t,s){1&t&&(f.TgZ(0,"app-container",0),f.NdJ("containerInit",function(t){return s.onContainerInit(t)})("vrSessionStart",function(){return s.onVRSessionStart()})("vrSessionEnd",function(){return s.onVRSessionEnd()}),f.qZA(),f.TgZ(1,"app-menu",1),f.NdJ("switchFlyMode",function(){return s.onSwitchFlyMode()})("switchStats",function(){return s.onSwitchStats()})("switchDefinition",function(){return s.onSwitchDefinition()})("switchAntialias",function(){return s.onSwitchAntialias()}),f.ALo(2,"async"),f.ALo(3,"async"),f.ALo(4,"async"),f.ALo(5,"async"),f.qZA()),2&t&&(f.Q6J("stats$",s.stats$)("antialias$",s.antialias$)("vrButtonEnable",!0),f.xp6(1),f.Q6J("flyModeActive",f.lcZ(2,7,s.flyMode$))("statsActive",f.lcZ(3,9,s.stats$))("hdDefinitionActive",f.lcZ(4,11,s.isHDDefinition$))("antialiasActive",f.lcZ(5,13,s.antialias$)))},directives:[F.e,Z.M],pipes:[n.Ov],styles:[""]}),t})()}];let P=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[a.Bz.forChild(J)],a.Bz]}),t})(),B=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[c.Aw.forFeature(z,C)]]}),t})(),I=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[n.ez,o.m,P,B]]}),t})()}}]);