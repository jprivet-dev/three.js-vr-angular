(self.webpackChunkapp=self.webpackChunkapp||[]).push([[954],{7954:(t,s,e)=>{"use strict";e.r(s),e.d(s,{AviatorModule:()=>F});var o={};e.r(o),e.d(o,{switchAntialias:()=>d,switchFlyMode:()=>h,vrSessionEnd:()=>p,vrSessionStart:()=>l});var n=e(8583),i=e(8873),a=e(9812),r=e(7747),c=e(5466);const h=(0,c.PH)("[Aviator] switch fly mode"),d=(0,c.PH)("[Aviator] switch antialias"),l=(0,c.PH)("[Aviator] VR session start"),p=(0,c.PH)("[Aviator] VR session end");(0,c.G0)(o);var w=e(7716),u=e(8468),f=e(7894),m=e(270),v=e(2628),g=e(5319),y=e(7758);class S extends y.u9r{constructor(t){super();const s=[],e=[],o=new y.iMs;o.ray.direction.set(0,-1,0);for(let n=0;n<2e3;n++){const n=500*Math.random()-250,i=500*Math.random()-250;o.ray.origin.set(n,50,i);const a=o.intersectObject(t);if(0===a.length)continue;const r=a[0].point.y,c=5*Math.random()+.5;let h=Math.random()*Math.PI*2;s.push(n+Math.sin(h),r,i+Math.cos(h)),s.push(n,r+c,i),s.push(n+Math.sin(h+Math.PI),r,i+Math.cos(h+Math.PI)),h+=Math.PI/2,s.push(n+Math.sin(h),r,i+Math.cos(h)),s.push(n,r+c,i),s.push(n+Math.sin(h+Math.PI),r,i+Math.cos(h+Math.PI));const d=.1*Math.random();for(let t=0;t<6;t++)e.push(.2+d,.4+d,0)}this.setAttribute("position",new y.TlE(new Float32Array(s),3)),this.setAttribute("color",new y.TlE(new Float32Array(e),3))}}var M=e(8804);class b extends y.Hyl{constructor(t){super(),this.size=t,this.point=new y.Pa4,this.tangent=new y.Pa4}getPointAt(t){t=t*Math.PI*2;const s=Math.sin(3*t)*Math.cos(4*t)*this.size,e=2*Math.sin(10*t)+2*Math.cos(17*t)+5,o=Math.sin(t)*Math.sin(4*t)*this.size;return this.point.set(s,e,o).multiplyScalar(2)}getTangentAt(t){const s=1e-4,e=Math.max(0,t-s),o=Math.min(1,t+s);return this.tangent.copy(this.getPointAt(o)).sub(this.getPointAt(e)).normalize()}}class A{constructor(t,s,e,o){this.curve=t,this.dolly=s,this.train=e,this.object=o,this.position=new y.Pa4,this.positionOffset=new y.Pa4,this.tangent=new y.Pa4,this.lookAt=new y.Pa4,this.velocity=0,this.progress=0,this.offset=1e-4,this.diffY=0,this.angleXZ={current:0,last:0,diff:0}}update(t){var s,e;this.progress+=this.velocity,this.progress=this.progress%1,this.positionOffset.copy(this.curve.getPointAt(this.progress-this.offset)),this.diffY=this.positionOffset.y-this.position.y,this.angleXZ.current=(s=this.position,e=this.positionOffset,Math.atan2(e.z-s.z,e.x-s.x)),this.angleXZ.diff=this.angleXZ.last-this.angleXZ.current,this.position.copy(this.curve.getPointAt(this.progress)),this.train.position.copy(this.position),this.object.position.y=30*-this.diffY+.2,this.object.rotation.set(10*-this.diffY,30*this.angleXZ.diff,110*this.angleXZ.diff),this.dolly.rotation.set(0,0,20*this.angleXZ.diff),this.tangent.copy(this.curve.getTangentAt(this.progress)),this.velocity-=1e-7*this.tangent.y*t,this.velocity=Math.max(8e-5,Math.min(2e-4,this.velocity));const o=this.lookAt.copy(this.position).sub(this.tangent);this.train.lookAt(o),this.angleXZ.last=this.angleXZ.current}}const x=(t,s,e,o,n)=>{const i=((t,s)=>{const e=[],o=t.getX(s),n=t.getY(s),i=t.getZ(s);for(let a=0;a<t.array.length;a++)o===t.getX(a)&&n===t.getY(a)&&i===t.getZ(a)&&e.push(a);return e})(t,s);((t,s,e,o,n)=>{("number"==typeof s?[s]:s).map(s=>{t.setXYZ(s,t.getX(s)+e,t.getY(s)+o,t.getZ(s)+n)})})(t,i,e,o,n)};var j=(()=>(function(t){t[t.red=15881030]="red",t[t.white=14209233]="white",t[t.brown=5845806]="brown",t[t.pink=16095342]="pink",t[t.brownDark=2300175]="brownDark",t[t.blue=6865856]="blue"}(j||(j={})),j))();class P{constructor(){this.mesh=new y.Tme,this.mesh.name="pilot",this.angleHairs=0;const t=new y.DvJ(15,15,15),s=new y.xoR({color:j.brown,flatShading:!0}),e=new y.Kj0(t,s);e.position.set(2,-12,0),this.mesh.add(e);const o=new y.DvJ(10,10,10),n=new y.YBo({color:j.pink}),i=new y.Kj0(o,n);this.mesh.add(i);const a=new y.DvJ(4,4,4),r=new y.YBo({color:j.brown}),c=new y.Kj0(a,r);c.geometry.applyMatrix4((new y.yGw).makeTranslation(0,2,0));const h=new y.Tme;this.hairsTop=new y.Tme;for(let y=0;y<12;y++){const t=c.clone(),s=y%3,e=Math.floor(y/3);t.position.set(4*e-4,0,4*s-4),this.hairsTop.add(t)}h.add(this.hairsTop);const d=new y.DvJ(12,4,2);d.applyMatrix4((new y.yGw).makeTranslation(-6,0,0));const l=new y.Kj0(d,r),p=l.clone();l.position.set(8,-2,6),p.position.set(8,-2,-6),h.add(l),h.add(p);const w=new y.DvJ(2,8,10),u=new y.Kj0(w,r);u.position.set(-1,-4,0),h.add(u),h.position.set(-5,5,0),this.mesh.add(h);const f=new y.DvJ(5,5,5),m=new y.YBo({color:j.brown}),v=new y.Kj0(f,m);v.position.set(6,0,3);const g=v.clone();g.position.z=-v.position.z;const S=new y.DvJ(11,1,11),M=new y.Kj0(S,m);this.mesh.add(v),this.mesh.add(g),this.mesh.add(M);const b=new y.DvJ(2,3,2),A=new y.Kj0(b,n);A.position.set(0,0,-6);const x=A.clone();x.position.set(0,0,6),this.mesh.add(A),this.mesh.add(x)}update(t){const s=this.hairsTop.children,e=s.length;for(let o=0;o<e;o++)s[o].scale.y=.75+.25*Math.cos(this.angleHairs+o/3);this.angleHairs+=.16}}class z{constructor(){const t=new y.Tme;this.mesh=new y.Tme,this.mesh.name="airPlane";const s=new y.DvJ(80,50,50,1,1,1),e=s.getAttribute("position");x(e,4,0,-10,20),x(e,5,0,-10,-20),x(e,6,0,30,20),x(e,7,0,30,-20);const o=new y.xoR({color:j.red,flatShading:!0}),n=new y.Kj0(s,o);n.castShadow=!0,n.receiveShadow=!0,t.add(n);const i=new y.DvJ(20,50,50,1,1,1),a=new y.xoR({color:j.white,flatShading:!0}),r=new y.Kj0(i,a);r.position.x=50,r.castShadow=!0,r.receiveShadow=!0,t.add(r);const c=new y.DvJ(15,20,5,1,1,1),h=new y.xoR({color:j.red,flatShading:!0}),d=new y.Kj0(c,h);d.position.set(-40,20,0),d.castShadow=!0,d.receiveShadow=!0,t.add(d);const l=new y.DvJ(30,5,120,1,1,1),p=new y.xoR({color:j.red,flatShading:!0}),w=new y.Kj0(l,p);w.position.set(0,15,0),w.castShadow=!0,w.receiveShadow=!0,t.add(w);const u=new y.DvJ(3,15,20,1,1,1),f=new y.xoR({color:j.white,transparent:!0,opacity:.3,flatShading:!0}),m=new y.Kj0(u,f);m.position.set(5,27,0),m.castShadow=!0,m.receiveShadow=!0,t.add(m);const v=new y.DvJ(20,10,10,1,1,1),g=v.getAttribute("position");x(g,4,0,-5,5),x(g,5,0,-5,-5),x(g,6,0,5,5),x(g,7,0,5,-5);const S=new y.xoR({color:j.brown,flatShading:!0});this.propeller=new y.Kj0(v,S),this.propeller.castShadow=!0,this.propeller.receiveShadow=!0;const M=new y.DvJ(1,80,10,1,1,1),b=new y.xoR({color:j.brownDark,flatShading:!0}),A=new y.Kj0(M,b);A.position.set(8,0,0),A.castShadow=!0,A.receiveShadow=!0;const z=A.clone();z.rotation.x=Math.PI/2,z.castShadow=!0,z.receiveShadow=!0,this.propeller.add(A),this.propeller.add(z),this.propeller.position.set(60,0,0),t.add(this.propeller);const D=new y.DvJ(30,15,10,1,1,1),J=new y.xoR({color:j.red,flatShading:!0}),k=new y.Kj0(D,J);k.position.set(25,-20,25),t.add(k);const Z=new y.DvJ(24,24,4),K=new y.xoR({color:j.brownDark,flatShading:!0}),T=new y.Kj0(Z,K);T.position.set(25,-28,25);const R=new y.DvJ(10,10,6),Y=new y.xoR({color:j.brown,flatShading:!0}),$=new y.Kj0(R,Y);T.add($),t.add(T);const I=k.clone();I.position.z=-k.position.z,t.add(I);const E=T.clone();E.position.z=-T.position.z,t.add(E);const X=T.clone();X.scale.set(.5,.5,.5),X.position.set(-35,-5,0),t.add(X);const O=new y.DvJ(4,20,4);O.applyMatrix4((new y.yGw).makeTranslation(0,10,0));const B=new y.xoR({color:j.red,flatShading:!0}),F=new y.Kj0(O,B);F.position.set(-35,-5,0),F.rotation.z=-.3,t.add(F),this.pilot=new P,this.pilot.mesh.position.set(-10,27,0),t.add(this.pilot.mesh),t.castShadow=!0,t.receiveShadow=!0,t.rotateY(Math.PI/2),this.mesh.add(t)}update(t){this.propeller.rotation.x+=.3,this.pilot.update(t)}}const D={fov:50,near:.1,far:3e4,vrSession:{onStart:{camera:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},dolly:{position:{x:0,y:.7,z:2},rotation:{x:0,y:0,z:0}}},onEnd:{camera:{position:{x:0,y:.7,z:3},rotation:{x:0,y:0,z:0}},dolly:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}}}},J="aviator",k=(0,c.Lq)({flyMode:!1,vrSession:!1},(0,c.on)(h,t=>Object.assign(Object.assign({},t),{flyMode:!t.flyMode})),(0,c.on)(l,t=>Object.assign(Object.assign({},t),{vrSession:!0})),(0,c.on)(p,t=>Object.assign(Object.assign({},t),{vrSession:!1}))),Z=(0,c.ZF)(J),K=(0,c.P1)(Z,t=>t.flyMode),T=(0,c.P1)(Z,t=>t.vrSession);let R=(()=>{class t{constructor(t){this.store=t,this.flyMode$=this.store.select(K),this.vrSession$=this.store.select(T)}dispatch(t){this.store.dispatch(t)}}return t.\u0275fac=function(s){return new(s||t)(w.LFG(c.yh))},t.\u0275prov=w.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Y=(()=>{class t{constructor(t){this.facade=t,this.subscription=new g.w,this.dollyCameraParams=D,this.controlsActive=!1,this.controlsUpdate=()=>{},this.animate=()=>{},this.completed=!1}buildScene(t){this.completed?this.update(t):(this.create(t),this.completed=!0)}create(t){const s=new v.$,e=new m.M;e.add(t);const o=new y.xsS;o.fog=new y.ybr(16243114,.1,500),o.background=new y.Ilk(16243114),this.dollyCameraParams.aspect=t.ratio();const n=new u.ak(this.dollyCameraParams);s.add(n),t.resizeAdd(n);const i=new y.Tme;i.add(n),o.add(i),(()=>{const t=new y.vmT(11184810,0,.9),s=new y.Mig(14452852,.5),e=new y.Ox3(16777215,.9);e.position.set(150,350,350),e.castShadow=!0,e.shadow.camera.left=-400,e.shadow.camera.right=400,e.shadow.camera.top=400,e.shadow.camera.bottom=-400,e.shadow.camera.near=1,e.shadow.camera.far=1e3,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,o.add(t),o.add(s),o.add(e)})(),(()=>{const t=new y._12(500,500,15,15);t.rotateX(-Math.PI/2);const s=t.getAttribute("position").array,e=new y.Pa4;for(let h=0;h<s.length;h+=3){e.fromArray(s,h),e.x+=10*Math.random()-5,e.z+=10*Math.random()-5;const t=e.distanceTo(o.position)/5-25;e.y=Math.random()*Math.max(0,t),e.toArray(s,h)}t.computeVertexNormals();const n=new y.YBo({color:4222976}),i=new y.Kj0(t,n);o.add(i);const a=new S(i),r=new M.v({side:y.ehD,vertexColors:!0}),c=new y.Kj0(a,r);o.add(c)})();const a=new z,r=.01;a.mesh.scale.set(r,r,r),i.add(a.mesh),e.add(a);const c=new b(50),h=new A(c,n,i,a.mesh);if(e.add(h),e.add({update:t=>{}}),this.controlsActive){const s=new f.bq(n.camera,t.renderer.domElement,{autoRotateSpeed:.2,autoRotate:!0,target:a.mesh.position.clone()});e.add(s),this.controlsUpdate=t=>{s.updateDomElement(t.renderer.domElement)}}this.subscription=this.facade.vrSession$.subscribe(t=>{t?s.onSessionStart():s.onSessionEnd()}),this.animate=t=>{t.renderer.setAnimationLoop(()=>{e.update(),t.renderer.render(o,n.camera)})},this.animate(t)}update(t){this.controlsActive&&this.controlsUpdate(t),this.animate(t)}unsubscribe(){this.completed=!1,this.subscription.unsubscribe(),this.subscription=new g.w}}return t.\u0275fac=function(s){return new(s||t)(w.LFG(R))},t.\u0275prov=w.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var $=e(2647),I=e(2107),E=e(6534);const X=[{path:"",component:(()=>{class t{constructor(t,s,e,o){this.window=t,this.service=s,this.app=e,this.facade=o,this.flyMode$=this.facade.flyMode$,this.stats$=this.app.stats$,this.antialias$=this.app.antialias$}onContainerInit(t){this.service.buildScene(t)}onSwitchFlyMode(){this.facade.dispatch(h())}onSwitchStats(){this.app.dispatch(r.q.switchStats())}onSwitchAntialias(){this.app.dispatch(r.q.switchAntialias())}onVRSessionStart(){this.facade.dispatch(l())}onVRSessionEnd(){this.facade.dispatch(p())}ngOnDestroy(){this.service.unsubscribe()}}return t.\u0275fac=function(s){return new(s||t)(w.Y36(Window),w.Y36(Y),w.Y36($.l),w.Y36(R))},t.\u0275cmp=w.Xpm({type:t,selectors:[["app-aviator-page"]],decls:5,vars:13,consts:[[3,"stats$","antialias$","vrButtonEnable","containerInit","vrSessionStart","vrSessionEnd"],[3,"flyModeActive","statsActive","hdDefinitionEnable","antialiasActive","switchFlyMode","switchStats","switchAntialias"]],template:function(t,s){1&t&&(w.TgZ(0,"app-container",0),w.NdJ("containerInit",function(t){return s.onContainerInit(t)})("vrSessionStart",function(){return s.onVRSessionStart()})("vrSessionEnd",function(){return s.onVRSessionEnd()}),w.qZA(),w.TgZ(1,"app-menu",1),w.NdJ("switchFlyMode",function(){return s.onSwitchFlyMode()})("switchStats",function(){return s.onSwitchStats()})("switchAntialias",function(){return s.onSwitchAntialias()}),w.ALo(2,"async"),w.ALo(3,"async"),w.ALo(4,"async"),w.qZA()),2&t&&(w.Q6J("stats$",s.stats$)("antialias$",s.antialias$)("vrButtonEnable",!0),w.xp6(1),w.Q6J("flyModeActive",w.lcZ(2,7,s.flyMode$))("statsActive",w.lcZ(3,9,s.stats$))("hdDefinitionEnable",!1)("antialiasActive",w.lcZ(4,11,s.antialias$)))},directives:[I.e,E.M],pipes:[n.Ov],styles:["canvas{background:linear-gradient(#e4e0ba,#f7d9aa)}"]}),t})()}];let O=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[a.Bz.forChild(X)],a.Bz]}),t})(),B=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[c.Aw.forFeature(J,k)]]}),t})(),F=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[n.ez,i.m,O,B]]}),t})()}}]);