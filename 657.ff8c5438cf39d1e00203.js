(self.webpackChunkapp=self.webpackChunkapp||[]).push([[657],{1657:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AviatorModule:()=>V});var s={};n.r(s),n.d(s,{switchAntialias:()=>d,switchFlyMode:()=>c,vrSessionEnd:()=>l,vrSessionStart:()=>h});var o=n(8583),a=n(4304),i=n(9812),r=n(5466);const c=(0,r.PH)("[Aviator] switch fly mode"),d=(0,r.PH)("[Aviator] switch antialias"),h=(0,r.PH)("[Aviator] VR session start"),l=(0,r.PH)("[Aviator] VR session end");(0,r.G0)(s);var w=n(7716),p=n(457),u=n(9723),m=n(4007),v=n(1115),f=n(270);class S{constructor(t,e,n,s){this.loop=t,this.renderer=e,this.scene=n,this.camera=s,this.setAnimationLoop()}resize(t){this.camera.aspect=t.ratio(),this.camera.updateProjectionMatrix(),this.renderer.setSize(t.width(),t.height())}updateRenderer(t){this.renderer.setAnimationLoop(null),this.renderer=t,this.setAnimationLoop()}setAnimationLoop(){this.renderer.setAnimationLoop(()=>{this.loop.update(),this.renderer.render(this.scene,this.camera)})}}var g=n(5319),y=n(7758);class M extends y.u9r{constructor(t){super();const e=[],n=[],s=new y.iMs;s.ray.direction.set(0,-1,0);for(let o=0;o<2e3;o++){const o=500*Math.random()-250,a=500*Math.random()-250;s.ray.origin.set(o,50,a);const i=s.intersectObject(t);if(0===i.length)continue;const r=i[0].point.y,c=5*Math.random()+.5;let d=Math.random()*Math.PI*2;e.push(o+Math.sin(d),r,a+Math.cos(d)),e.push(o,r+c,a),e.push(o+Math.sin(d+Math.PI),r,a+Math.cos(d+Math.PI)),d+=Math.PI/2,e.push(o+Math.sin(d),r,a+Math.cos(d)),e.push(o,r+c,a),e.push(o+Math.sin(d+Math.PI),r,a+Math.cos(d+Math.PI));const h=.1*Math.random();for(let t=0;t<6;t++)n.push(.2+h,.4+h,0)}this.setAttribute("position",new y.TlE(new Float32Array(e),3)),this.setAttribute("color",new y.TlE(new Float32Array(n),3))}}var b=n(1429);class A extends y.Hyl{constructor(t){super(),this.size=t,this.point=new y.Pa4,this.tangent=new y.Pa4}getPointAt(t){t=t*Math.PI*2;const e=Math.sin(3*t)*Math.cos(4*t)*this.size,n=2*Math.sin(10*t)+2*Math.cos(17*t)+5,s=Math.sin(t)*Math.sin(4*t)*this.size;return this.point.set(e,n,s).multiplyScalar(2)}getTangentAt(t){const e=1e-4,n=Math.max(0,t-e),s=Math.min(1,t+e);return this.tangent.copy(this.getPointAt(s)).sub(this.getPointAt(n)).normalize()}}const P=(t,e,n,s,o)=>{const a=((t,e)=>{const n=[],s=t.getX(e),o=t.getY(e),a=t.getZ(e);for(let i=0;i<t.array.length;i++)s===t.getX(i)&&o===t.getY(i)&&a===t.getZ(i)&&n.push(i);return n})(t,e);((t,e,n,s,o)=>{("number"==typeof e?[e]:e).map(e=>{t.setXYZ(e,t.getX(e)+n,t.getY(e)+s,t.getZ(e)+o)})})(t,a,n,s,o)};var x=(()=>(function(t){t[t.red=15881030]="red",t[t.white=14209233]="white",t[t.brown=5845806]="brown",t[t.pink=16095342]="pink",t[t.brownDark=2300175]="brownDark",t[t.blue=6865856]="blue"}(x||(x={})),x))();class j{constructor(){this.mesh=new y.Tme,this.mesh.name="pilot",this.angleHairs=0;const t=new y.DvJ(15,15,15),e=new y.xoR({color:x.brown,flatShading:!0}),n=new y.Kj0(t,e);n.position.set(2,-12,0),this.mesh.add(n);const s=new y.DvJ(10,10,10),o=new y.YBo({color:x.pink}),a=new y.Kj0(s,o);this.mesh.add(a);const i=new y.DvJ(4,4,4),r=new y.YBo({color:x.brown}),c=new y.Kj0(i,r);c.geometry.applyMatrix4((new y.yGw).makeTranslation(0,2,0));const d=new y.Tme;this.hairsTop=new y.Tme;for(let y=0;y<12;y++){const t=c.clone(),e=y%3,n=Math.floor(y/3);t.position.set(4*n-4,0,4*e-4),this.hairsTop.add(t)}d.add(this.hairsTop);const h=new y.DvJ(12,4,2);h.applyMatrix4((new y.yGw).makeTranslation(-6,0,0));const l=new y.Kj0(h,r),w=l.clone();l.position.set(8,-2,6),w.position.set(8,-2,-6),d.add(l),d.add(w);const p=new y.DvJ(2,8,10),u=new y.Kj0(p,r);u.position.set(-1,-4,0),d.add(u),d.position.set(-5,5,0),this.mesh.add(d);const m=new y.DvJ(5,5,5),v=new y.YBo({color:x.brown}),f=new y.Kj0(m,v);f.position.set(6,0,3);const S=f.clone();S.position.z=-f.position.z;const g=new y.DvJ(11,1,11),M=new y.Kj0(g,v);this.mesh.add(f),this.mesh.add(S),this.mesh.add(M);const b=new y.DvJ(2,3,2),A=new y.Kj0(b,o);A.position.set(0,0,-6);const P=A.clone();P.position.set(0,0,6),this.mesh.add(A),this.mesh.add(P)}update(t){const e=this.hairsTop.children,n=e.length;for(let s=0;s<n;s++)e[s].scale.y=.75+.25*Math.cos(this.angleHairs+s/3);this.angleHairs+=.16}}class R{constructor(){const t=new y.Tme;this.mesh=new y.Tme,this.mesh.name="airPlane";const e=new y.DvJ(80,50,50,1,1,1),n=e.getAttribute("position");P(n,4,0,-10,20),P(n,5,0,-10,-20),P(n,6,0,30,20),P(n,7,0,30,-20);const s=new y.xoR({color:x.red,flatShading:!0}),o=new y.Kj0(e,s);o.castShadow=!0,o.receiveShadow=!0,t.add(o);const a=new y.DvJ(20,50,50,1,1,1),i=new y.xoR({color:x.white,flatShading:!0}),r=new y.Kj0(a,i);r.position.x=50,r.castShadow=!0,r.receiveShadow=!0,t.add(r);const c=new y.DvJ(15,20,5,1,1,1),d=new y.xoR({color:x.red,flatShading:!0}),h=new y.Kj0(c,d);h.position.set(-40,20,0),h.castShadow=!0,h.receiveShadow=!0,t.add(h);const l=new y.DvJ(30,5,120,1,1,1),w=new y.xoR({color:x.red,flatShading:!0}),p=new y.Kj0(l,w);p.position.set(0,15,0),p.castShadow=!0,p.receiveShadow=!0,t.add(p);const u=new y.DvJ(3,15,20,1,1,1),m=new y.xoR({color:x.white,transparent:!0,opacity:.3,flatShading:!0}),v=new y.Kj0(u,m);v.position.set(5,27,0),v.castShadow=!0,v.receiveShadow=!0,t.add(v);const f=new y.DvJ(20,10,10,1,1,1),S=f.getAttribute("position");P(S,4,0,-5,5),P(S,5,0,-5,-5),P(S,6,0,5,5),P(S,7,0,5,-5);const g=new y.xoR({color:x.brown,flatShading:!0});this.propeller=new y.Kj0(f,g),this.propeller.castShadow=!0,this.propeller.receiveShadow=!0;const M=new y.DvJ(1,80,10,1,1,1),b=new y.xoR({color:x.brownDark,flatShading:!0}),A=new y.Kj0(M,b);A.position.set(8,0,0),A.castShadow=!0,A.receiveShadow=!0;const R=A.clone();R.rotation.x=Math.PI/2,R.castShadow=!0,R.receiveShadow=!0,this.propeller.add(A),this.propeller.add(R),this.propeller.position.set(60,0,0),t.add(this.propeller);const D=new y.DvJ(30,15,10,1,1,1),z=new y.xoR({color:x.red,flatShading:!0}),J=new y.Kj0(D,z);J.position.set(25,-20,25),t.add(J);const K=new y.DvJ(24,24,4),T=new y.xoR({color:x.brownDark,flatShading:!0}),k=new y.Kj0(K,T);k.position.set(25,-28,25);const I=new y.DvJ(10,10,6),Y=new y.xoR({color:x.brown,flatShading:!0}),$=new y.Kj0(I,Y);k.add($),t.add(k);const E=J.clone();E.position.z=-J.position.z,t.add(E);const F=k.clone();F.position.z=-k.position.z,t.add(F);const O=k.clone();O.scale.set(.5,.5,.5),O.position.set(-35,-5,0),t.add(O);const B=new y.DvJ(4,20,4);B.applyMatrix4((new y.yGw).makeTranslation(0,10,0));const L=new y.xoR({color:x.red,flatShading:!0}),Z=new y.Kj0(B,L);Z.position.set(-35,-5,0),Z.rotation.z=-.3,t.add(Z),this.pilot=new j,this.pilot.mesh.position.set(-10,27,0),t.add(this.pilot.mesh),t.castShadow=!0,t.receiveShadow=!0,t.rotateY(Math.PI/2),this.mesh.add(t)}update(t){this.propeller.rotation.x+=.3,this.pilot.update(t)}}const D={fov:50,near:.1,far:3e4,onVRSessionStartPosition:{camera:{x:0,y:0,z:0},dolly:{x:0,y:.7,z:2}},onVRSessionEndPosition:{camera:{x:0,y:.7,z:3},dolly:{x:0,y:0,z:0}}};var z=n(9263);const J="aviator",K=(0,r.Lq)({flyMode:!1,antialias:!0,vrSession:!1},(0,r.on)(c,t=>Object.assign(Object.assign({},t),{flyMode:!t.flyMode})),(0,r.on)(d,t=>Object.assign(Object.assign({},t),{antialias:!t.antialias})),(0,r.on)(h,t=>Object.assign(Object.assign({},t),{vrSession:!0})),(0,r.on)(l,t=>Object.assign(Object.assign({},t),{vrSession:!1}))),T=(0,r.ZF)(J),k=(0,r.P1)(T,t=>t.flyMode),I=(0,r.P1)(T,t=>t.antialias),Y=(0,r.P1)(T,t=>t.vrSession);let $=(()=>{class t{constructor(t){this.store=t,this.flyMode$=this.store.select(k),this.antialias$=this.store.select(I),this.vrSession$=this.store.select(Y)}dispatch(t){this.store.dispatch(t)}}return t.\u0275fac=function(e){return new(e||t)(w.LFG(r.yh))},t.\u0275prov=w.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),E=(()=>{class t{constructor(t,e){this.store=t,this.facade=e,this.dollyCameraParams=D,this.subscription=new g.w,this.controlsActive=!1}buildScene({container:t,renderer:e}){const n=new m.$,s=new v.A(t),o=new f.M,a=new y.xsS;a.fog=new y.ybr(16243114,.1,500),a.background=new y.Ilk(16243114);const i=new p.a(t,this.dollyCameraParams);n.add(i);const r=new y.Tme;r.add(i),a.add(r),this.rendererManager=new S(o,e,a,i.camera),s.add(this.rendererManager),(()=>{const t=new y.vmT(11184810,0,.9),e=new y.Mig(14452852,.5),n=new y.Ox3(16777215,.9);n.position.set(150,350,350),n.castShadow=!0,n.shadow.camera.left=-400,n.shadow.camera.right=400,n.shadow.camera.top=400,n.shadow.camera.bottom=-400,n.shadow.camera.near=1,n.shadow.camera.far=1e3,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,a.add(t),a.add(e),a.add(n)})();const c=new A(50),d=new y.Pa4,h=new y.Pa4,l=new y.Pa4,w=new y.Pa4;let g=0,P=0,x=0,j=0,D=0,z=0;(()=>{const t=new y._12(500,500,15,15);t.rotateX(-Math.PI/2);const e=t.getAttribute("position").array;console.log("positions",e);const n=new y.Pa4;for(let d=0;d<e.length;d+=3){n.fromArray(e,d),n.x+=10*Math.random()-5,n.z+=10*Math.random()-5;const t=n.distanceTo(a.position)/5-25;n.y=Math.random()*Math.max(0,t),n.toArray(e,d)}t.computeVertexNormals();const s=new y.YBo({color:4222976}),o=new y.Kj0(t,s);a.add(o);const i=new M(o),r=new b.v({side:y.ehD,vertexColors:!0}),c=new y.Kj0(i,r);a.add(c)})();const J=new R,K=.01;J.mesh.scale.set(K,K,K),r.add(J.mesh),o.add(J);const T=new class{update(t){((t,e)=>{var n,s;P+=g,P%=1,h.copy(c.getPointAt(P-1e-4)),x=h.y-d.y,n=d,s=h,j=Math.atan2(s.z-n.z,s.x-n.x),z=D-j,d.copy(c.getPointAt(P)),r.position.copy(d),t.mesh.rotation.set(10*-x,30*z,110*z),t.mesh.position.y=30*-x+.2,i.rotation.set(0,0,20*z),l.copy(c.getTangentAt(P)),g-=1e-7*l.y*e,g=Math.max(8e-5,Math.min(2e-4,g)),r.lookAt(w.copy(d).sub(l)),D=j})(J,t)}};o.add(T),this.subscription.add(this.facade.vrSession$.subscribe(t=>{t?n.onSessionStart():n.onSessionEnd()})),this.controlsActive&&(this.controls=new u.bq(i.camera,e.domElement,{autoRotateSpeed:.2,autoRotate:!0,target:J.mesh.position}),o.add(this.controls))}updateRenderer({renderer:t}){this.rendererManager.updateRenderer(t),this.controlsActive&&this.controls.updateDomElement(t.domElement)}unsubscribe(){this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(w.LFG(z.d),w.LFG($))},t.\u0275prov=w.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=n(6901),O=n(6534);const B=[{path:"",component:(()=>{class t{constructor(t,e,n){this.window=t,this.service=e,this.facade=n,this.rendererParameters={},this.flyMode$=this.facade.flyMode$,this.antialias$=this.facade.antialias$}onRendererInit(t){this.service.buildScene(t)}onRendererUpdate(t){this.service.updateRenderer(t)}onSwitchFlyMode(){this.facade.dispatch(c())}onSwitchAntialias(){this.facade.dispatch(d())}onVRSessionStart(){this.facade.dispatch(h())}onVRSessionEnd(){this.facade.dispatch(l())}ngOnDestroy(){this.service.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(w.Y36(Window),w.Y36(E),w.Y36($))},t.\u0275cmp=w.Xpm({type:t,selectors:[["app-aviator-page"]],decls:4,vars:10,consts:[[3,"antialias$","parameters","vrButton","rendererInit","rendererUpdate","vrSessionStart","vrSessionEnd"],[3,"isflyMode","hdDefinitionActive","isAntialias","switchFlyMode","switchAntialias"]],template:function(t,e){1&t&&(w.TgZ(0,"app-renderer",0),w.NdJ("rendererInit",function(t){return e.onRendererInit(t)})("rendererUpdate",function(t){return e.onRendererUpdate(t)})("vrSessionStart",function(){return e.onVRSessionStart()})("vrSessionEnd",function(){return e.onVRSessionEnd()}),w.qZA(),w.TgZ(1,"app-menu",1),w.NdJ("switchFlyMode",function(){return e.onSwitchFlyMode()})("switchAntialias",function(){return e.onSwitchAntialias()}),w.ALo(2,"async"),w.ALo(3,"async"),w.qZA()),2&t&&(w.Q6J("antialias$",e.antialias$)("parameters",e.rendererParameters)("vrButton",!0),w.xp6(1),w.Q6J("isflyMode",w.lcZ(2,6,e.flyMode$))("hdDefinitionActive",!1)("isAntialias",w.lcZ(3,8,e.antialias$)))},directives:[F.J,O.M],pipes:[o.Ov],styles:["canvas{background:linear-gradient(#e4e0ba,#f7d9aa)}"]}),t})()}];let L=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[i.Bz.forChild(B)],i.Bz]}),t})(),Z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[r.Aw.forFeature(J,K)]]}),t})(),V=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[o.ez,a.m,L,Z]]}),t})()}}]);